title: "click300延迟与点击穿透"
date: 2015-12-22 11:32:09
categories: js
tags: [点击穿透]
---

# click300延迟与点击穿透
**由来：**ios safari双击放大页面，由于浏览器大都具备这种特性，所以浏览器都约定在300毫秒的间隔来判断是否是双击还是单击，超过300毫秒还没第二次点击浏览器才判断此次点击是单击。
点击穿透事件介绍：并不是说绑定了click事件然后产生了穿透，而是一系列因果集合而产生了穿透这个不需要的现象。
**产生穿透事件的条件：**
1、两个dom在屏幕的垂直方向是重叠的，并且z-index不同。
2、采用touch系列的点击事件去点击朝外的dom，并且这个dom隐藏或者移开。
3、在下方的dom绑定了click或者默认的点击事件（a标签，buttom等）
只有满足上述条件才会触发穿透事件，就是点击外dom，外dom消失，但下边的dom也会触发click事件（比如跳转链接）
**产生此现象的原因：**
因为click的300延迟，导致用户体验不佳，所以很多人都会采用touch系列代替click。
在点击事件中，点击的顺序是这样的：
`touchstart > touchmove > touchend > click`
而轮到click事件的时候还在再延迟了300毫秒，所以touchstart的触发速度是远大于click的，回到上述的产生穿透的条件中去
1、touchstart事件触发，外层dom消失，**可是点击屏幕后会有个浏览器默认的click产生，首先就作用于当时click触发时点击的屏幕最外层的dom，即在重叠的条件下，zindex最大的dom，然后顺着dom树往上爬**
2、因为有300毫秒的延迟，所以在第一步的touchstart后，外层dom就消失了，等300毫秒后click触发了，等着他的dom却是在下面那层的dom（因为此时这个dom已经在最上层了），所以原本在下面的这个dom就触发了click事件。
所以说外层dom会消失是很重要的条件，如果外层dom没有消失，那延迟的click触发时还是作用在外层的dom上，而外层dom没绑定click事件。
**这就是穿透的原理。**
**如何解决穿透：**
1、顺着这个思路，既然每次单击是都会有个浏览器的click默认事件触发，既然我们不需要，那就把这个默认事件取消掉就好了，所以在js中加上这句话
```
if (ev.type == 'touchend') {
	ev.preventDefault();
}
```
2、或者干脆给外层的dom绑定click事件，全部解决了。。对于关闭弹框啥的，300毫秒的延迟关闭还是可以接受的。
3、引入fastClick.js
公司里用的就是这个插件库，用了这个插件库，绑定touchstart不用担心引发迟来的click，直接绑定click也不会有300毫秒的延迟了，也就是很完美的解决了问题。